${(host.substr(host.length-6,6) == '.onion') ? HTML_TOR_HEAD:HTML_HEAD}
  <title>${currencyName}-monit</title>
</head>
<body>

<!-- Afficher le menu -->
<table align="center" width="100%">
  <tr>
    <td><a href="willMembers?lg=${MENU_LANG['LG']}${(typeof(help) != 'undefined' && help == 'no') ? '&help=no':''}">${MENU_LANG["WILL_MEMBERS"]}</a></td>
    <td><a href="members?lg=${MENU_LANG['LG']}${(typeof(help) != 'undefined' && help == 'no') ? '&help=no':''}">${MENU_LANG["MEMBERS"]}</a></td>
    <td><a href="membersCount?lg=${MENU_LANG['LG']}${(typeof(help) != 'undefined' && help == 'no') ? '&help=no':''}">${MENU_LANG["MEMBERS_COUNT"]}</a></td>
    <td><a href="blockCount?lg=${MENU_LANG['LG']}${(typeof(help) != 'undefined' && help == 'no') ? '&help=no':''}">${MENU_LANG["BLOCK_COUNT"]}</a></td>
    <td><a href="monetaryMass?lg=${MENU_LANG['LG']}${(typeof(help) != 'undefined' && help == 'no') ? '&help=no':''}">${MENU_LANG["MONETARY_MASS"]}</a></td>
    <td><a href="wotex?lg=${MENU_LANG['LG']}${(typeof(help) != 'undefined' && help == 'no') ? '&help=no':''}">${MENU_LANG["WOTEX"]}</a></td>
    <td><a href="about?lg=${MENU_LANG['LG']}${(typeof(help) != 'undefined' && help == 'no') ? '&help=no':''}">${MENU_LANG["ABOUT"]}</a></td>
    <td>
      <form action="" method="GET">
	<select name="lg" onchange="this.form.submit()">
	  <option name="lg" value="fr" ${MENU_LANG['LG'] == 'fr' ? 'selected' : ''}>FR
	  <option name="lg" value="en" ${MENU_LANG['LG'] == 'en' ? 'selected' : ''}>EN
	</select>
    </td>
</tr>
</table>
<hr>

<!-- Afficher le formulaire -->
<input type="number" name="d" value="${days}"/>${LANG["FORM1"]} <select name="sort_by">
<option name="sort_by" value ="idtyWritten">${LANG["SORT_BY_IDTY_WRITTEN"]}
<option name="sort_by" value ="expireMembership" ${sort_by == 'expireMembership' ? 'selected' : ''}>${LANG["SORT_BY_EXPIRE_MEMBERSHIP"]} date d\'expiration du membership
<option name="sort_by" value ="lastRenewal" ${sort_by == 'lastRenewal' ? 'selected' : ''}>${LANG["SORT_LAST_RENEWAL"]} date de dernier renouvellement
<option name="sort_by" value ="oldestSig" ${sort_by == 'oldestSig' ? 'selected' : ''}>${LANG["SORT_BY_OLDEST_SIG"]} date de plus vielle certification
<option name="sort_by" value ="lastSig" ${sort_by == 'lastSig' ? 'selected' : ''}>${LANG["SORT_BY_LAST_SIG"]} date de plus récente certification
<option name="sort_by" value ="sigCount" ${sort_by == 'sigCount' ? 'selected' : ''}>${LANG["SORT_BY_SIG_COUNT"]} nombre de certifications reçues
</select> ${LANG["ORDER_BY"]} <select name="order">
<option name="order" value ="asc"> ${LANG["ASC"]}
<option name="order" value ="desc" ${order == 'desc' ? 'selected' : ''}> ${LANG["DESC"]}</select>
<input type="submit" value="envoyer"><br>
<input type="checkbox" name="pendingSigs" value="yes" ${pendingSigs == 'yes' ? 'checked' : ''}>${LANG["CHECKBOX_PENDING_SIGS"]}</form><br>

<!-- Afficher la légende -->
<br>
${(pendingSigs == 'yes' && help != 'no') ? ` ${LANG["LEGEND_AVAILABILITY"]}<br>` : ''}

<!-- Afficher le currentBlockchainTimestamp -->
<i>${LANG["CURRENT_BLOCKCHAIN_TIME"]} : ${timestampToDatetime(currentBlockchainTimestamp)}.</i><br>
<br>

<!-- On parcour tout les membres pour afficher ceux dont la date d'expiration est dans moins de 'd' jours -->
<b>${LANG["TABLE_TITLE"]} ${days} ${LANG["DAYS"]} :</b>
<table border="1">
  <!-- Printer les nom des colonnes -->
  <tr>
    <td align="center">${LANG["COL_UID"]}</td>
    <td align="center">${LANG["COL_IDTY_WRITTEN_TIME"]}</td>
    <td align="center">${LANG["COL_LAST_RENEWAL"]}</td>
    <td align="center">${LANG["COL_EXPIRE_MEMBERSHIP"]}</td>
    <td style="background:#000000">-</td>
    <td align="left" colspan="${nbMaxCertifs}">liste des certifications reçues (${sort_by == 'lastSig' ? LANG["LAST2OLDEST"] : LANG["OLDEST2LAST"]})</td>
  </tr>
  
  ${membersListFiltered
    .map( member=> `
      <!-- Printer la ligne -->
      <tr>
        ${(member.proportion = proportion(member.expireMembershipTimestamp,msValidity,0,120),'')}
        <td align="center" style="background:hsla(${member.proportion}, 100%, 50%, 1)">
        <!--<td align="center" style="background:#${color}">-->
          <h3>${member.uid}</h3>
          ->${member.certifications.length}
          ${pendingSigs == "yes" && member.pendingCertifications.length > 0 
            ? `(${member.pendingCertifications.length})` 
            : ''}
        </td>
        <!--<td align="center" style="background:hsla(0, 0%, ${member.proportion}%, 1)">-->
        <td align="center" style="background:hsla(${member.proportion}, 100%, 50%, 1)">
        <!--<td align="center" style="background:#${color}">-->
          ${timestampToDatetime(member.idtyWrittenTimestamp)}<br>
          #${member.idtyWrittenBloc}
        </td>
        <td align="center" style="background:hsla(${member.proportion}, 100%, 50%, 1)">
        <!--<td align="center" style="background:#${color}">-->
          ${timestampToDatetime(member.lastRenewalTimestamp)}<br>
          #${member.lastRenewalWrittenBloc}
        </td>
        <td align="center" style="background:hsla(${member.proportion}, 100%, 50%, 1)">
        <!--<td align="center" style="background:#${color}">-->
          ${timestampToDatetime(member.expireMembershipTimestamp)}</td>
        <td style="background:#000000">-</td>
  
        <!-- Printer les certifications en piscine -->
        ${pendingSigs == "yes" ?
            member.pendingCertifications.map( certification=> `
              <!-- Printer la certification -->
              <td align="center" style="background:${color(certification.timestampExpire,sigWindow,200)})">
                ${certification.from}<br>
                ${timestampToDatetime(certification.timestampExpire)}<br>
                ${LANG["EMITTED"]} #${certification.blockNumber}<br>
                [inscriptible ${timestampToDatetime(certification.timestampWritable)}]
              </td>
            `).join('') 
        :''}
    
        <!-- Printer les certifications écrites en blockchain -->
        ${member.certifications.map( certification=> `
          <!-- Printer la certification -->
          <td align="center" style="background:hsla(${proportion(certification.timestampExpire,sigValidity,0,120)}, 100%, 50%, 1 )">
            ${certification.issuer}<br>
            ${timestampToDatetime(certification.timestampExpire)}<br>
            ${LANG["WRITTEN"]} #${certification.writtenBloc}
          </td>
        `).join('')}
      </tr>
    `).join('')
  }
  <tr>
    <td colspan="${4+nbMaxCertifs}" align="center"> ${LANG["OVERALL"]} : <b>${membersListFiltered.length}</b> ${LANG["MEMBERS"]}.</td>
  </tr>
</table><br>

<hr>
